<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Student Fee Management System</title>


    <div>
        <div>
            <select id="select"></select>
        </div>
        <div>
            <button id="search">Search</button>
        </div>
        <div>
            <select id="select_student" required aria-placeholder="Click Search Button First"></select>
        </div>
    </div>

    <script>

        window.onload = function () {


            fetch('http://localhost:3000/api/batch', {
                headers: {
                    "authorization": localStorage.getItem('Token')
                }
            })
                .then(data => {
                    return data.json()
                })
                .then(json => {
                    const list = document.getElementById('list');
                    const select = document.getElementById('select');
                    for (let i = 0; i < json.length; i++) {
                        const option = document.createElement('OPTION'),
                            txt = document.createTextNode(json[i].batch_name);
                        option.appendChild(txt);
                        option.setAttribute("value", json[i]);
                        select.insertBefore(option, select.lastChild);
                    }
                });

            function onClick(event) {
                const val = select.selectedIndex;
                const batch = select.options[val].innerText;
                console.log(batch)
                fetch('http://localhost:3000/api/students/batch/' + batch)
                    .then(data => {
                        return data.json()
                    })
                    .then(json => {
                        const select_student = document.getElementById('select_student');
                        select_student.options.length = null;  //to clear the elements in drop down menu.
                        for (let i = 0; i < json.length; i++) {
                            const option = document.createElement('OPTION'),
                                txt = document.createTextNode(json[i].student_id);
                            option.appendChild(txt);
                            option.setAttribute("value", json[i]);
                            select_student.insertBefore(option, select_student.firstChild);
                        }

                    })
                    .catch(error => {
                        console.log(error)
                        alert(error)
                    })
            }

            const searchButton = document.getElementById('search');
            searchButton.addEventListener('click', onClick)
        }
    </script>
    </div>
</head>

<body>

</body>

</html>