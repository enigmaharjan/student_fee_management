<!-- views/partials/header.ejs -->

<nav class="navbar navbar-expand-sm navbar-dark bg-dark p-0 ">
  <a href="/index" class="navbar-brand">Softwarica Fee Department</a>
  <button class="navbar-toggler" data-toggle="collapse" data-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item px-2">
        <a href="/index" class="nav-link">Dashboard</a>
      </li>
      <li class="nav-item px-2">
        <a href="/form" class="nav-link">Fee</a>
      </li>
      <li class="nav-item px-2">
        <a href="/batch" class="nav-link">Class</a>
      </li>
      <li class="nav-item px-2">
        <a href="/student" class="nav-link">Student</a>
      </li>
    </ul>

    <ul class="navbar-nav ml-auto navbar-right">
      <li class="nav-item dropdown mr-3">
        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
          <i class="fa fa-user"></i> Welcome, <div id="username_header" style="display: inline-block"> </div>
        </a>
        <div class="dropdown-menu">
          <a href="profile.html" class="dropdown-item">
            <i class="fa fa-user-circle"></i> Profile
          </a>
          <a href="settings.html" class="dropdown-item">
            <i class="fa fa-gear"></i> Settings
          </a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/">
          <i class="fa fa-user-times"></i> Logout
        </a>
      </li>
    </ul>
  </div>
</nav>

<script>

  var Anchors = document.getElementsByTagName("a");

  for (var i = 0; i < Anchors.length; i++) {
    Anchors[i].addEventListener("click",
      function (event) {
        // event.preventDefault();
        if(this.href === 'http://localhost:8080/'){
        if (confirm('Are you sure?')) {
            let keysToRemove = ["Token", "username"];
            for (key of keysToRemove) {
              localStorage.removeItem(key);
            }
            window.location = this.href;
          }
        }
      },
      false);
  }

  // const uname = document.getElementById('username_header')
  //   uname.innerText = localStorage.getItem("username");

  fetch("http://localhost:3000/api/students/" + localStorage.getItem("username"))
  .then(data=>{
    console.log("im her")
    console.log(data)
    return data.json()
  })
  .then(json=>{
    console.log("im her")
    console.log(json)
    const uname = document.getElementById('username_header')
    uname.innerText = json[0].student_name;
  })

</script>